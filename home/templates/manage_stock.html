{% extends 'index.html' %}

{% block title %}Manage Stock - Young4Chicks{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h2><i class="fas fa-warehouse"></i> Manage Stock</h2>
        <p class="text-muted">Add and manage chick stock inventory</p>
    </div>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="content-section">
            <div class="section-header success-header">
                <h5><i class="fas fa-plus"></i> Add New Stock</h5>
            </div>
            <div class="section-body">
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label for="{{ form.chick_type.id_for_label }}" class="form-label">Chick Type</label>
                        {{ form.chick_type }}
                        {% if form.chick_type.errors %}
                            <div class="text-danger">{{ form.chick_type.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.quantity.id_for_label }}" class="form-label">Quantity</label>
                        {{ form.quantity }}
                        {% if form.quantity.errors %}
                            <div class="text-danger">{{ form.quantity.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.age_in_days.id_for_label }}" class="form-label">Age (Days)</label>
                        {{ form.age_in_days }}
                        {% if form.age_in_days.errors %}
                            <div class="text-danger">{{ form.age_in_days.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Price per Chick</label>
                        <div class="form-control-plaintext">
                            <strong>UGx 1,650</strong> (Fixed)
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-success w-100">
                        <i class="fas fa-plus"></i> Add Stock
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-8">
        <div class="content-section">
            <div class="section-header info-header">
                <h5><i class="fas fa-list"></i> Current Stock Inventory</h5>
            </div>
            <div class="section-body">
                {% if stock_items %}
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Chick Type</th>
                                    <th>Quantity</th>
                                    <th>Age (Days)</th>
                                    <th>Price</th>
                                    <th>Date Added</th>
                                    <th>Added By</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for stock in stock_items %}
                                <tr {% if stock.quantity == 0 %}class="text-muted"{% endif %}>
                                    <td>{{ stock.get_chick_type_display }}</td>
                                    <td>
                                        <span class="badge {% if stock.quantity > 0 %}bg-success{% else %}bg-secondary{% endif %}">
                                            {{ stock.quantity }}
                                        </span>
                                    </td>
                                    <td>{{ stock.age_in_days }}</td>
                                    <td>UGx {{ stock.price_per_chick }}</td>
                                    <td>{{ stock.date_added|date:"M d, Y H:i" }}</td>
                                    <td>{{ stock.added_by.user.get_full_name }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mt-3">
                        <h6>Stock Summary by Type:</h6>
                        <div class="row">
                            {% regroup stock_items by chick_type as grouped_stock %}
                            {% for group in grouped_stock %}
                            <div class="col-md-6 mb-2">
                                <div class="info-box primary-box">
                                    <div class="stock-summary">
                                        <strong>{{ group.grouper|title }}</strong><br>
                                        <span class="text-primary">
                                            Total: 
                                            {% with total=0 %}
                                                {% for stock in group.list %}
                                                    {% if forloop.first %}{{ stock.quantity }}{% else %} + {{ stock.quantity }}{% endif %}
                                                {% endfor %}
                                                chicks
                                            {% endwith %}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
                        <h5>No stock available</h5>
                        <p class="text-muted">Add your first stock entry using the form on the left.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="mt-3">
    <a href="{% url 'dashboard' %}" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
    </a>
</div>

<script>
    // Add Bootstrap classes to form fields
    document.addEventListener('DOMContentLoaded', function() {
        const inputs = document.querySelectorAll('input, select');
        inputs.forEach(input => {
            if (!input.classList.contains('form-control')) {
                input.classList.add('form-control');
            }
        });
    });
</script>
{% endblock %}
